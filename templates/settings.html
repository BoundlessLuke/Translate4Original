<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设置 - 文件翻译助手</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义主题 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6', // 蓝色 - 主色调
                        secondary: '#10b981', // 绿色 - 辅助色
                        accent: '#8b5cf6', // 紫色 - 强调色
                        neutral: '#1f2937', // 深色
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
        }
    </style>
    
    <style>
        /* 自定义样式 */
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50 text-neutral min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-primary flex items-center gap-2">
                <i class="fa fa-language text-accent"></i>
                <span>文件翻译助手</span>
            </h1>
            <div class="flex items-center gap-4">
                <a href="/" class="text-gray-600 hover:text-primary transition-colors duration-200">
                    <i class="fa fa-home"></i>
                    <span class="hidden md:inline ml-1">首页</span>
                </a>
                <a href="#" class="text-gray-600 hover:text-primary transition-colors duration-200">
                    <i class="fa fa-question-circle"></i>
                    <span class="hidden md:inline ml-1">帮助</span>
                </a>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="container mx-auto px-4 py-8 flex-grow">
        <!-- 设置页面标题 -->
        <section class="text-center mb-10">
            <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4 text-neutral">翻译设置</h2>
            <p class="text-gray-600 max-w-2xl mx-auto mb-8">自定义翻译提示词和API配置，提升翻译质量。</p>
        </section>

        <!-- 设置表单区域 -->
        <section class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
            <form id="settings-form">
                <!-- 提示词设置区域 - 第一步翻译 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <label for="prompt_step1" class="block text-sm font-medium text-gray-700">第一步翻译提示词</label>
                        <button type="button" id="reset-prompt-step1" class="text-xs text-primary hover:text-primary/80 transition-colors duration-200">
                            重置为默认
                        </button>
                    </div>
                    <textarea id="prompt_step1" name="prompt_step1" rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus resize-none" placeholder="输入第一步翻译提示词...">{{ default_prompt_step1 }}</textarea>
                    <p class="mt-2 text-xs text-gray-500">此提示词用于初始翻译，将源语言文本转换为目标语言。</p>
                </div>

                <!-- 提示词设置区域 - 第二步翻译纠错 -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <label for="prompt_step2" class="block text-sm font-medium text-gray-700">第二步翻译纠错提示词</label>
                        <button type="button" id="reset-prompt-step2" class="text-xs text-primary hover:text-primary/80 transition-colors duration-200">
                            重置为默认
                        </button>
                    </div>
                    <textarea id="prompt_step2" name="prompt_step2" rows="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg input-focus resize-none" placeholder="输入第二步翻译纠错提示词...">{{ default_prompt_step2 }}</textarea>
                    <p class="mt-2 text-xs text-gray-500">此提示词用于改进初始翻译，纠正错误并提高翻译质量。</p>
                </div>

                <!-- API配置区域 -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">OpenAI API配置</h3>
                    
                    <div class="mb-4">
                        <label for="api_key" class="block text-sm font-medium text-gray-700 mb-1">API密钥</label>
                        <input type="password" id="api_key" name="api_key" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus" placeholder="sk-...">
                    </div>
                    
                    <div class="mb-4">
                        <label for="api_base" class="block text-sm font-medium text-gray-700 mb-1">API基础URL</label>
                        <input type="text" id="api_base" name="api_base" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus" value="http://medelurl/v1" placeholder="http://medelurl/v1">
                    </div>
                    
                    <div class="mb-2">
                        <label for="model" class="block text-sm font-medium text-gray-700 mb-1">模型名称</label>
                        <input type="text" id="model" name="model" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus" value="modelname" placeholder="modelname">
                    </div>
                </div>

                <!-- 保存按钮 -->
                <div class="flex justify-end gap-4">
                    <a href="/" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center gap-2">
                        <i class="fa fa-arrow-left"></i>
                        <span>返回首页</span>
                    </a>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary/90 text-white rounded-lg shadow-md transition-all duration-200 flex items-center justify-center gap-2">
                        <i class="fa fa-save"></i>
                        <span>保存设置</span>
                    </button>
                </div>
            </form>
        </section>

        <!-- 设置说明 -->
        <section class="mt-10 max-w-4xl mx-auto">
            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2">
                    <i class="fa fa-info-circle"></i>
                    设置说明
                </h4>
                <ul class="text-sm text-blue-700 space-y-2">
                    <li><i class="fa fa-check-circle mr-2"></i> 提示词支持变量替换：<code>{{source_lang}}</code> 会被替换为源语言，<code>{{target_lang}}</code> 会被替换为目标语言。</li>
                    <li><i class="fa fa-check-circle mr-2"></i> API密钥等敏感信息仅保存在您的浏览器本地，不会上传到服务器。</li>
                    <li><i class="fa fa-check-circle mr-2"></i> 重置为默认值将会恢复到系统预设的提示词。</li>
                </ul>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white py-6 border-t border-gray-200 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-600 text-sm">文件翻译助手 &copy; 2025 - BoundlessLuke保留所有权利</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // DOM元素
        const settingsForm = document.getElementById('settings-form');
        const promptStep1Textarea = document.getElementById('prompt_step1');
        const promptStep2Textarea = document.getElementById('prompt_step2');
        const resetPromptStep1Btn = document.getElementById('reset-prompt-step1');
        const resetPromptStep2Btn = document.getElementById('reset-prompt-step2');
        const apiKeyInput = document.getElementById('api_key');
        const apiBaseInput = document.getElementById('api_base');
        const modelInput = document.getElementById('model');
        
        // 默认提示词
        const defaultPromptStep1 = "{{ default_prompt_step1 }}";
        const defaultPromptStep2 = "{{ default_prompt_step2 }}";
        
        // 页面加载时，从localStorage加载保存的设置
        document.addEventListener('DOMContentLoaded', () => {
            // 加载提示词设置
            const savedPromptStep1 = localStorage.getItem('prompt_step1');
            if (savedPromptStep1) {
                promptStep1Textarea.value = savedPromptStep1;
            }
            
            const savedPromptStep2 = localStorage.getItem('prompt_step2');
            if (savedPromptStep2) {
                promptStep2Textarea.value = savedPromptStep2;
            }
            
            // 加载API配置
            const savedConfig = localStorage.getItem('apiConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                if (config.api_key) apiKeyInput.value = config.api_key;
                if (config.api_base) apiBaseInput.value = config.api_base;
                if (config.model) modelInput.value = config.model;
            }
        });
        
        // 重置第一步提示词为默认值
        resetPromptStep1Btn.addEventListener('click', () => {
            promptStep1Textarea.value = defaultPromptStep1;
        });
        
        // 重置第二步提示词为默认值
        resetPromptStep2Btn.addEventListener('click', () => {
            promptStep2Textarea.value = defaultPromptStep2;
        });
        
        // 保存设置
        settingsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // 保存提示词设置到localStorage
            localStorage.setItem('prompt_step1', promptStep1Textarea.value);
            localStorage.setItem('prompt_step2', promptStep2Textarea.value);
            
            // 保存API配置到localStorage
            const apiConfig = {
                api_key: apiKeyInput.value,
                api_base: apiBaseInput.value,
                model: modelInput.value
            };
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
            
            // 显示成功消息
            alert('设置已保存！');
            
            // 重定向到首页
            window.location.href = '/';
        });
    </script>
</body>
</html>
